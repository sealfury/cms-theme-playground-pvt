{% require_css %}
  <style>
    {% scope_css %}

    {# Menu items - top level #}
    {% set chevronPath = "../../images/module-icons/chevron-icon-light.png" %}
    {% set hoverCheveronPath = "../../images/module-icons/chevron-icon-black.png" %}

    {% if module.styles.text.color.color %}
      .top-menu__item--depth-1 > .top-menu__link {
        {{ module.styles.border.border.css }}
        color: {{ module.styles.text.color.color }};
      }

      .top-menu__child-toggle-icon {
        background: url({{ get_asset_url(chevronPath) }}) no-repeat;
        border-top-color: {{ module.styles.text.color.color }};
      }

      .top-menu .top-menu__link:hover,
      .top-menu .top-menu__link:focus {   
        color: {{ module.styles.hover.color.color }};
      }

      .top-menu__child-toggle-icon:hover,
      .top-menu__child-toggle-icon:focus {
        background: url({{ get_asset_url(hoverCheveronPath) }}) no-repeat;
        border-top-color: {{ module.styles.hover.color.color }};
      }

      .top-menu .top-menu__link:active {
        color: {{ color_variant(module.styles.hover.color.color, 40) }};
      }

      .top-menu__child-toggle-icon:active {
        background: url({{ get_asset_url(hoverCheveronPath) }}) no-repeat;
        border-top-color: {{ color_variant(module.styles.hover.color.color, 40) }};
      }

      .top-menu .top-menu__item--depth-1 > .top-menu__link--active-link:after {
        background-color: {{ module.styles.text.color.color }};
      }
    {% endif %}

    {# Menu items - submenus #}

    .top-menu .top-menu__submenu {
      {{ module.styles.dropdowns.border.border.css }}
      {% if module.styles.dropdowns.background.color.color %}
        background-color: rgba({{ module.styles.dropdowns.background.color.color|convert_rgb }}, {{ module.styles.dropdowns.background.color.opacity / 100 }});
      {% endif %}
    }

    @media (min-width: 767px) {
      {{ module.styles.dropdowns.border.border.css }}
      {% if module.styles.dropdowns.background.color.color %}
      .top-menu__submenu--level-2 > .top-menu__item:first-child:before {
        background-color: rgba({{ module.styles.dropdowns.background.color.color|convert_rgb }}, {{ module.styles.dropdowns.background.color.opacity / 100 }});
      }
      {% endif %}
    }

    .top-menu__submenu .top-menu__link {
      {% if module.styles.dropdowns.background.color.color %}
        color: rgba({{ module.styles.dropdowns.text.color.color|convert_rgb }}, {{ module.styles.dropdowns.text.color.opacity / 100 }});
      {% endif %}
    }

    .top-menu__submenu .top-menu__link:hover,
    .top-menu__submenu .top-menu__link:focus {
      {% if module.styles.dropdowns.text.color.color %}
        color: rgba({{ module.styles.dropdowns.text.color.color|convert_rgb }}, 1);
      {% endif %}
    }

    {% set basePath = "../../images/module-icons" %}
    {% set menuIcons = [""] %}

    {% end_scope_css %}
  </style>
{% end_require_css %}

{# Menu items #}

{% macro menu_items() %}

  {% set menu = menu(module.menu, "site_root").children %}

  {% macro render_link_item(link, depth) %}
    <li class="top-menu__item top-menu__item--depth-{{ depth }} {{ "top-menu__item--has-submenu" if link.children and depth < module.max_levels }}">
      {% if link.url %}
        <a 
          class="top-menu__link top-menu__link--depth-{{ depth }} {{ "top-menu__link--toggle" if link.children and depth < module.max_levels }}"
          href="{{ link.url }}"
          {{ 'aria-haspopup="true" aria-expanded="false"' if link.children and depth < module.max_levels }}
          {{ 'aria-current="page"' if link.activeNode }}
          {{ 'target="_blank" rel="noopener"' if link.linkTarget }}
        >
          {{ link.label }}
        </a>
      {% else %}
        {% if link.children and depth < module.max_levels %}
          <a class="top-menu__link top-menu__link--toggle" href="#" aria-haspopup="true" aria-expanded="false">{{ link.label }}</a>
        {% else %}
          <span class="top-menu__link">{{ link.label }}</span>
        {% endif %}
      {% endif %}

      {% if link.children %}
        {% if depth and depth < module.max_levels %}
          <button class="top-menu__child-toggle no-button" aria-expanded="false">
            <span ckass="show-for-sr">Show submenu for {{ link.label }}</span>
            <span class="top-menu__child-toggle-icon"></span>
          </button>
          <ul class="top-menu__submenu top-menu__submenu--level-{{ depth + 1 }} no-list">
            {% set depth = depth + 1 %}
            {% for sublink in link.children %}
              {{ render_link_item(sublink, depth) }}
            {% endfor %}
          </ul>
        {% endif %}
      {% endif %}
    </li>
  {% endmacro %}

  {% for link in menu %}
    {{ render_link_item(link, 1) }}
  {% endfor %}

{% endmacro %}

{# Dekstop #}

<nav class="top-menu top-menu--desktop" aria-label="Top Menu">
  <ul class="top-menu__wrapper no-list">
    {{ menu_items() }}
  </ul>
</nav>

{# Mobile #}

<nav class="top-menu top-menu--mobile" aria-label="Top Menu">
  <ul class="top-menu__wrapper">
    {{ menu_items() }}
  </ul>
</nav>